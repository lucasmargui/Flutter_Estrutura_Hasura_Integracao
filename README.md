<H1 align="center">Flutter Firebase integration with Hasura</H1>
<p align="center">ðŸš€ Development of a framework containing Firebase,GraphQL and CloudFunctions for future references</p>

## Resources Used
- Flutter 3.3.5
- Get_it 7.6.0
- Firebase_core 2.24.2
- Firebase_auth 4.16.0
- cloud_functions: ^4.6.0
- graphql_flutter: ^5.1.2


## Hasura Configuration:

### Creation of the Hasura Project

Visit the Hasura website at https://hasura.io/.
Log in or create an account if you don't already have one.
Create a new project in Hasura.

### Database creation

After creating the project, you can create a database within Hasura.
Follow the instructions provided in the Hasura interface to create the database.


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/f96a0bd3-e985-44d1-a87c-e4131804509a" style="width:70%">
</div>

### Creating tables


Use the Hasura interface to create the necessary tables following the flowchart. This typically involves defining the fields, data types, and relationships between tables.



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/03a7ae93-42f2-4cbd-ada8-38a90f3e5ee4" style="width:90%">
</div>


## Configuration of Hasura variables

Hasura_graphql_jwt_secret is a secret key used for generating and validating JWT tokens (JSON Web Tokens) in Hasura. JWTs are often used for authentication and authorization in distributed systems.

In the context of Hasura, this key is used to sign the JWT tokens generated by Hasura when a user is authenticated. These JWT tokens may contain authorization information and other information required to access Hasura-protected resources.

### Addition of the Key "Hasura_graphql_jwt_secret" in the api variables generating a JWT Config for Firebase



### Step 1: In the project open "Env vars" and click on "New Env Var".


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/e5b195b3-cef9-445c-9959-c6f9de460ee4" style="width:70%">
</div>


### Step 2 : Select HASURA_GRAPHQL_JWT_SECRET



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/27a3f53c-1342-4a19-b61f-c0e5e685819c" style="width:70%">
</div>

### Step 3: Generation of JWT Config for Firebase

Access the website https://hasura.io/jwt-config and fill in the project information.


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/53ae3331-b7e0-4f91-b345-409a426fcc28" style="width:70%">
</div>

### Step 4: JWT CONFIG

With jwt generated add the key and save HASURA_GRAPHQL_JWT_SECRET



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/9a342838-fe4d-4014-af9a-321f77c302cb" style="width:70%">
</div>

## Firebase Configuration:

### Firebase Project Creation

Visit the Firebase Console at https://console.firebase.google.com/.
Create a new project or select an existing project.

```
dart pub global activate flutterfire_cli

flutter pub add cloud_functions

flutterfire configure

```

### Initializing Firebase init in Flutter project:

```
firebase init
```

Open a terminal and navigate to your Flutter project directory.
Run the command to start configuring Firebase in your Flutter project.

### Choosing the Functions configuration:

During the Firebase startup process, you will be asked to choose which features you want to configure. Choose the Cloud Functions for this project.


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/e8f35bea-1e93-4e5d-860f-f5325193809e" style="width:90%">
</div>


### Choosing Javascript as the functions language:

During the Cloud Functions initialization process, you will be asked to choose the programming language. Choose JavaScript.

### Installation of GraphQL dependencies:

```
npm install --save graphql-request
```

When you finish configuring Firebase Init, use your project's package manager (usually npm or yarn) to install the dependencies necessary to work with GraphQL.

## Configuration functions

### Index.js

Index.js configuration based on the project console created in Hasura.



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/7ae03f00-7238-4170-8363-ea6153709125" style="width:50%">
</div>


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/52c805fc-eb17-4629-ba1b-8987c3839a44" style="width:100%">
</div>

### Exporting functions to Cloud Functions

Configure the functions according to your desired logic and based on your project needs and the endpoints provided by Hasura. This typically involves defining GraphQL resolvers and connecting to the Hasura database. At the end of exporting the functions, use the command to export the functions to cloud function.



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/530de225-dbd5-431f-85bf-136428306321" style="width:100%">
</div>

Command to export functions

```
firebase deploy

```


## Front-End Configuration

Add the graphql package to flutter.

```
flutter pub add graphql_flutter

```

### Using CloudFunction functions

To use the functions that were exported to CloudFunction, simply create a FirebaseFunction instance.



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/f7fecd29-5d78-4c3e-bf78-128ce9c9ab79" style="width:70%">
</div>

and invoke them through a httpsCallable and the name of the exported function

<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/6209524e-e581-4909-b83b-d7cec3a9af5d" style="width:70%">
</div>


### Creation of GraphQLService



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/087977a0-3827-430d-b62f-2ae628ad4ad2" style="width:100%">
</div>

By defining GraphQLClient as a late variable, it means we have declared it, but we will not pass its value yet. Its value will be initialized after calling the Future<void> init function, which connects to the GraphQL endpoint, creates an authentication link using the Bearer token and, later, passes this concatenated link to instantiate the client, passing the link with authentication as property.

To avoid repeatedly creating this instance in locator, we can register GraphQLClient as a lazySingleton. This way, it will only be instantiated once when it is invoked, and we will be able to access the class properties repeatedly, as they will be stored in memory.



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/a10864f5-63a0-43fe-b9c8-20260fa6d21e" style="width:70%">
</div>


### Query using GraphQLService

Final client is retrieving the client property of the GraphQLService class which is a Singleton, when the init function is executed (in case of a successful registration or login) the authentication link stored in client will belong to the GraphQLService class and will be stored in memory can be accessed globally at any time


<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/9bc44fb6-feb0-456d-b824-b29b7f90c63e" style="width:70%">
</div>


With authenticated access, we will perform a query through the Hasura API and query the database in the Transactions table and use the query stored in constants/queries



<div align="center">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/6773d5f5-6356-4a07-b3e3-e5c2e1b59a60" style="width:45%">
 <img src="https://github.com/lucasmargui/Flutter_Estrutura_Hasura_Integracao/assets/157809964/db686221-8f65-41c6-adbe-3bc0757f99ef" style="width:45%">
</div>










